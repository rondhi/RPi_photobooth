#!/bin/bash

cd /home/pi/
#copy originals into 64GB flash drive mounted to a directory in /home/pi/photobooth_backup
cp photobooth_images/snap* /home/pi/photobooth_backup/photobooth_images/

#resize photos to 570x380
mogrify -resize 570x380 /home/pi/photobooth_images/*.jpg

#upload photos to Google Drive
sudo python /home/pi/scripts/photobooth/upload.py photobooth_images/snap_1*
sudo python /home/pi/scripts/photobooth/upload.py photobooth_images/snap_2*
sudo python /home/pi/scripts/photobooth/upload.py photobooth_images/snap_3*
sudo python /home/pi/scripts/photobooth/upload.py photobooth_images/snap_4*

#arrange four photos into vertical 1x4 table
montage /home/pi/photobooth_images/*.jpg -tile 1x4 -geometry +10+10 /home/pi/temp_montage2.jpg

#arrange strip into side by side copy
montage /home/pi/temp_montage2.jpg /home/pi/temp_montage2.jpg -tile 2x1 -geometry +5+5 /home/pi/temp_montage3.jpg

#add the photobooth logo under both strips
montage /home/pi/temp_montage3.jpg /home/pi/photobooth_label.jpg -tile 1x2 -geometry +0+0 /home/pi/temp_montage4.jpg

#send print job via CUPS
lp /home/pi/temp_montage4.jpg

#create copy of strip for reprint command
cp temp_montage4.jpg /home/pi/reprint.jpg

#archive strip to flash drive
suffix=$(date +%Y-%m-%d_%H%M%S)
cp /home/pi/temp_montage4.jpg /home/pi/photobooth_backup/PB_archive/PB_${suffix}.jpg

#cleanup
rm /home/pi/photobooth_images/*.jpg
rm /home/pi/temp*
